<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>나의 리뷰</title>
		<link rel="stylesheet" type="text/css" href="reviewList.css">
		
		
	</head>
	
	<body>
	<iframe src="../header.jsp" style="width: 100%; border: none"></iframe>
	<h1>나의 리뷰</h1>
		<table>	
			<tbody>
				<tr>
					<td> 
						<div class="review">
							<label>Movie name 1</label>
							<p id="recentReview" style="overflow-wrap: break-word;">
								Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
								Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
								when an unknown printer took a galley of type and scrambled it to make a type specimen book.
							</p>
							<button class="edit">리뷰 수정</button>
						</div>
					</td>
				</tr>
				
				<tr>
					<td> 
						<div class="review">
							<label>Sample movie name</label>
							<label id="userUp">&#128077;</label>
							<label>★★★</label>
							<p id="recentReview" style="overflow-wrap: break-word;">
								Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, 
								there live the blind texts. Separated they live in Bookmarksgrove right at the coast of 
								the Semantics, a large language ocean.
							</p>
							<button class="edit">리뷰 수정</button>
						</div>
					</td>
				</tr>
				
				<tr>
					<td> 
						<div class="review">
							<label>Movie name 3</label>
							<p id="recentReview" style="overflow-wrap: break-word;">
								Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
								Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
								when an unknown printer took a galley of type and scrambled it to make a type specimen book.
							</p>
							<button class="edit">리뷰 수정</button>
						</div>
					</td>
				</tr>
				
				<tr>
					<td> 
						<div class="review">
							<label>Movie name 4</label>
							<p id="recentReview" style="overflow-wrap: break-word;">
								Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
								Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
								when an unknown printer took a galley of type and scrambled it to make a type specimen book.
							</p>
							<button class="edit">리뷰 수정</button>
						</div>
					</td>
				</tr>
				
				<tr>
					<td> 
						<div class="review">
							<label>Movie name 5</label>
							<p id="recentReview" style="overflow-wrap: break-word;">
								Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
								Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
								when an unknown printer took a galley of type and scrambled it to make a type specimen book.
							</p>
							<button class="edit">리뷰 수정</button>
						</div>
					</td>
				</tr>
				
				<tr>
					<td> 
						<div class="review">
							<label>Movie name 6</label>
							<p id="recentReview" style="overflow-wrap: break-word;">
								Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
								Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
								when an unknown printer took a galley of type and scrambled it to make a type specimen book.
							</p>
							<button class="edit">리뷰 수정</button>
						</div>
					</td>
				</tr>
				
				<tr>
					<td> 
						<div class="review">
							<label>Movie name 7</label>
							<p id="recentReview" style="overflow-wrap: break-word;">
								Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
								Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
								when an unknown printer took a galley of type and scrambled it to make a type specimen book.
							</p>
							<button class="edit">리뷰 수정</button>
						</div>
					</td>
				</tr>
				
				<tr>
					<td> 
						<div class="review">
							<label>Movie name 8</label>
							<p id="recentReview" style="overflow-wrap: break-word;">
								Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
								Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
								when an unknown printer took a galley of type and scrambled it to make a type specimen book.
							</p>
							<button class="edit">리뷰 수정</button>
						</div>
					</td>
				</tr>
				
				<tr>
					<td> 
						<div class="review">
							<label>Movie name 9</label>
							<p id="recentReview" style="overflow-wrap: break-word;">
								Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
								Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
								when an unknown printer took a galley of type and scrambled it to make a type specimen book.
							</p>
							<button class="edit">리뷰 수정</button>
						</div>
					</td>
				</tr>
				
				<tr>
					<td> 
						<div class="review">
							<label>Movie name 10</label>
							<p id="recentReview" style="overflow-wrap: break-word;">
								Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
								Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
								when an unknown printer took a galley of type and scrambled it to make a type specimen book.
							</p>
							<button class="edit">리뷰 수정</button>
						</div>
					</td>
				</tr>
				
				<tr>
					<td> 
						<div class="review">
							<label>Movie name 11</label>
							<p id="recentReview" style="overflow-wrap: break-word;">
								Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
								Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
								when an unknown printer took a galley of type and scrambled it to make a type specimen book.
							</p>
							<button class="edit">리뷰 수정</button>
						</div>
					</td>
				</tr>
			</tbody>
		</table>
		
<!--  		<div class="reviewList">
			<div class="reviewItems">
				<div class="review">
					<label>Movie name 1</label>
					<p id="recentReview" style="overflow-wrap: break-word;">
						Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
						Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
						when an unknown printer took a galley of type and scrambled it to make a type specimen book.
					</p>
					<button class="edit">리뷰 수정</button>
				</div>
				
				
				<div class="review">
					<label>Movie name 2</label>
					<p id="recentReview" style="overflow-wrap: break-word;">
						Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
						Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
						when an unknown printer took a galley of type and scrambled it to make a type specimen book.
					</p>
					<button class="edit">리뷰 수정</button>
				</div>
				
				
				<div class="review">
					<label>Movie name 3</label>
					<p id="recentReview" style="overflow-wrap: break-word;">
						Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
						Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
						when an unknown printer took a galley of type and scrambled it to make a type specimen book.
					</p>
					<button class="edit">리뷰 수정</button>
				</div>
				
			</div>
		</div>		
			
		<div id="dummy" class="review">
			<label id="movieTitle">Movie name 3</label>
			<p id="movieReview">
				Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
				Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
				when an unknown printer took a galley of type and scrambled it to make a type specimen book.
			</p>
			<button id="editReview" class="edit">리뷰 수정</button>
		</div>	
			
		-->
		
		<button type="button" onclick="document.getElementById('editReview').style.display='block'">수정 창 열기</button>
		<button type="button" onclick="putReview(createMovieDiv('title', 'reviewText', 1, 4))">샘플 넣어보기</button>		
		<button type="button" onclick="extract(1)">2번째 영화 수정 해보기</button>
		<p id="ext">sample text</p>
		
		<div id="editReview" class="editing">
			<form class="contents" onsubmit="return confirm('정말 리뷰를 수정하시겠습니까?');">		
			<h2 style="text-align: center;">리뷰 수정</h2>
			<div class="editingReview">
				<span onclick="resetEdit()" class="close" title="창 닫기">&times;</span>
				<div>
					<label id="editReviewTitle">lorem ipsum</label>
					<input type="radio" name="thumbs" id="thumbsUp" value="up"> &#128077;
					<input type="radio" name="thumbs" id="thumbsDown" value="down"> &#128078;
						 <div class="star-rating">			            
				            <input type="radio" id="5-stars" name="rating" value="5" />
				            <label for="5-stars" class="star pr-4">★</label>
				            <input type="radio" id="4-stars" name="rating" value="4" />
				            <label for="4-stars" class="star">★</label>
				            <input type="radio" id="3-stars" name="rating" value="3" />
				            <label for="3-stars" class="star">★</label>
				            <input type="radio" id="2-stars" name="rating" value="2" />
				            <label for="2-stars" class="star">★</label>
				            <input type="radio" id="1-star" name="rating" value="1"  />
				            <label for="1-star" class="star">★</label>
       					</div>
				</div>	
				<textarea rows="5" cols="60" id="reviewArea" name="editedReview" required>lorem ipsum is longer in textarea</textarea>		
			</div>
			
			<div class="editReviewBtn" style="text-align: center;">
				<button type="submit">수정하기</button>
				<button type="button" onclick="resetEdit()">취소</button> 
			</div>
			
			</form>
		</div>
				
		<select name="itemsPerPage" id="itemsPerPage">
			<option value="3" selected>3</option>
			<option value="5">5</option>
			<option value="10">10</option>
			<option value="15">15</option>
			<option value="20">20</option>
		</select>
		
		<ul class="pagination">
			<li class="prev"><a href="#" id="prev">&#139;</a></li>
			<li class="next"><a href="#" id="next">&#155;</a></li>
		</ul>
	
	<iframe src="../footer.html" style="width: 100%; border: none"></iframe>
	</body>
	
	<script type="text/javascript">
		//DB에서 리뷰 로딩하기
		//putMovie와  createMovieDiv 이용 putMovie(createMovieDiv(title, reviewText, thumbs, starRating, reviewNum));
	
		let tbd = document.querySelector('tbody');
		let tr = tbd.getElementsByTagName('tr');
		let select = document.querySelector('select');
		let ul = document.querySelector('.pagination');

		
		
		
		let arrayTr=[];
		
		for (let i = 0; i < tr.length; i++) 
		{
		  arrayTr.push(tr[i]);
		}

		select.onchange=rowCount;
		
		function rowCount(e) 
		{
		  let neil= ul.querySelectorAll('.list');
		  neil.forEach(n=>n.remove());
		  let limit= parseInt(e.target.value);
		  displayPage(limit);
		}

		function displayPage(limit) 
		{
		  tbd.innerHTML='';
		  for (let i = 0; i < limit; i++)
		  {
		    tbd.appendChild(arrayTr[i]);
		  }
		  buttonGenerator(limit);
		}
		
		displayPage(3);

		function buttonGenerator(limit) 
		{
		  const nofTr=arrayTr.length;
		  if (nofTr <= limit) 
		  {
		    ul.style.display='none';
		  }
		  else
		  {
		    ul.style.display='flex';
		    const nofPage = Math.ceil(nofTr / limit);
		    
		    for (i = 1; i <= nofPage; i++) 
		    {
		      let li=document.createElement('li');
		      li.className='list';
		      let a=document.createElement('a');
		      a.className='page-link';
		      a.href='#';
		      a.setAttribute('data-page',i);
		      li.appendChild(a);
		      a.innerText=i;
		      ul.insertBefore(li,ul.querySelector('.next'));
		      
		      a.onclick=e=>
		      {
		        let x = e.target.getAttribute('data-page');
		        tbd.innerHTML='';
		        x--;
		        let start = limit * x;
		        let end = start+limit;
			    let page = arrayTr.slice(start,end);

		        for (let i = 0; i < page.length; i++) 
		        {
		          let item= page[i];
		          tbd.appendChild(item);
		        }
		      }
		    }
		  }

		  let z = 0;

		  function nextElement() 
		  {

		    if (this.id=='next') 
		    {
		      z == arrayTr.length - limit ? (z=0) : (z+=limit);
		    }

		    if (this.id=='prev') 
		    {
		      z == arrayTr.length <!-- or 0 --> ? arrayTr.length - limit : (z-=limit);
		    }

		    tbd.innerHTML='';
		    
		    for (let c = z; c < z + limit; c++) 
		    {
		      tbd.appendChild(arrayTr[c]);
		    }
		  }

		  document.getElementById('prev').onclick=nextElement;
		  document.getElementById('next').onclick=nextElement;

		}
		
		function putReview(movie)
		{
			var row = document.createElement("tr");
			var cell = document.createElement("td");
			cell.appendChild(movie);
			row.appendChild(cell);
			tbd.appendChild(row);
		}
		
		function createMovieDiv(title, reviewText, thumbs, starRating, reviewNum) 
		{
			var review = document.createElement("div");
			var userThumb = document.createElement("label");
			var userStar = document.createElement("label");
			var movieTitle = document.createElement("label");
			var paragraph = document.createElement("p");
			var btn = document.createElement("button");			
			const star = "★";
			
			var newTitle = document.createTextNode(title);
			var newText = document.createTextNode(reviewText);
			var newStar = document.createTextNode(star.repeat(starRating));
			userStar.className = "reviewStars";
			userStar.setAttribute('id', 'getStar')
			
			if(thumbs)
			{
				userThumb.innerHTML = "&#128077;";
				userStar.setAttribute('id', 'userUp');
			}
			else
			{
				userThumb.innerHTML = "&#128078;";
				userStar.setAttribute('id', 'userDown');
			}
						
			review.className = "review";			
			
			btn.innerHTML = "리뷰 수정";
			btn.className = "edit";
			btn.addEventListener("click", function() {extract(reviewNum)});
						
			movieTitle.appendChild(newTitle);
			paragraph.appendChild(newText);
			userStar.appendChild(newStar);
						
			review.appendChild(movieTitle);
			review.appendChild(userThumb);
			review.appendChild(userStar);
			review.appendChild(paragraph);
			review.appendChild(btn);
			
			return review;
		}
		
		function extract(index) 
		{
			var targetReviewCell = arrayTr[index].querySelector('td');
			var cellChild = targetReviewCell.childNodes;
			var targetReview = cellChild[1];
			
			document.getElementById("editReviewTitle").innerHTML = targetReview.childNodes[1].innerHTML; //제목
			setThumbs(targetReview.childNodes[3].id); //따봉
			var starNumber = targetReview.childNodes[5].innerHTML; 
			setStar(starNumber.length)//별점
			document.getElementById("reviewArea").innerText = ""; //평가
			//targetReview.childNodes[9].innerHTML; //버튼
			
			document.getElementById('editReview').style.display="block";
		}
		
		function setThumbs(pid) 
		{
			var radio = document.getElementsByName('thumbs');
			
			if (pid == "userUp") 
			{
				radio[0].checked = true;
			}
			else if (pid == "userDown") 
			{
				radio[1].checked = true;
			}
		}
		
		function setStar(stars) 
		{
			var radio = document.getElementsByName('rating');
			radio[stars - 1].checked = true;
		}
		
		
		
		function resetEdit() 
		{
			var radio1 = document.getElementsByName('thumbs');
			var radio2 = document.getElementsByName('rating');
			
			for(var i=0;i<radio1.length;i++)
			{
				radio1[i].checked = false;
			}
			
			for(var i=0;i<radio2.length;i++)
			{
				radio2[i].checked = false;
			}
			
			document.getElementById('reviewArea').value = "";
			document.getElementById('editReviewTitle').innerHTML = "dummy name";
			document.getElementById('editReview').style.display = "none";
		}
		</script>
</html>